(()=>{"use strict";const t=async()=>fetch("/mocks/json/catalog.json").then((async t=>await t.json())),e=e=>({getOne:async e=>(await t()).find((t=>t.id==e)),getBulk:async()=>{const a=JSON.parse(localStorage.getItem(e));if(a.length){return(await t()).filter((t=>a.some((e=>e.id==t.id))))}}}),a=t=>e=>"checkout"==t?function({id:t,image:e,title:a,dimensions:n,materials:c,price:i}){return`\n    <article class="checkout-item" data-id="${t}">\n      \x3c!-- <div class="checkout-item__checkmark"></div> --\x3e\n      <div class="checkout-item__body">\n        <div class="checkout-item__image">\n          <img src="${e}" alt="Картинка">\n        </div>\n        <div class="checkout-item__about">\n          <strong>${a}</strong>\n          <p><span>Габариты:</span>${n.join("х")} см</p>\n          <p><span>Материалы:</span>${c.join(", ")}</p>\n        </div>\n        <div class="checkout-item__counter">\n          <div class="actions-product__quantity quantity">\n            <button type="button" class="quantity__button quantity__button_plus"></button>\n            <div class="quantity__input">\n              <input autocomplete="off" type="text" name="form[]" value="1">\n            </div>\n            <button type="button" class="quantity__button quantity__button_minus"></button>\n          </div>\n        </div>\n        <div class="checkout-item__price">\n          <p>${i} ₽</p>\n          <small>72 719 ₽</small>\n          <strong>72 719 ₽</strong>\n        </div>\n      </div>\n      <div class="checkout-item__action-bar">\n        <a class="add-to-favorites">В избранное</a>\n        <a class="delete-from-cart">Удалить</a>\n      </div>\n    </article>\n  `}(e):"catalog"==t?function({id:t,image:e,title:a,dimensions:n,materials:c,price:i,rating:d,feedbacks:r}){return`\n    <article class="product-card" data-id="${t}">\n      <a href="" class="product-card__image">\n        <span class="product-card__item-image-ibg product-card__item-image-ibg_contain">\n          <img src="${e}" alt="Картинка">\n        </span>\n      </a>\n      <div class="product-card__body">\n        <h4 class="product-card__title">\n          <a href="" class="product-card__link-title">${a}</a>\n        </h4>\n        <div class="product-card__info info-product-card">\n          <div class="info-product-card__size">${n.join("х")}</div>\n          <div class="info-product-card__materials">${c.join(", ")}</div>\n        </div>\n        <div class="product-card__rating rating rating_set">\n          <div class="rating__body">\n            <div class="rating__active" style="width: 72%;"></div>\n            <div class="rating__items">\n              <input type="radio" class="rating__item" value="1" name="rating">\n              <input type="radio" class="rating__item" value="2" name="rating">\n              <input type="radio" class="rating__item" value="3" name="rating">\n              <input type="radio" class="rating__item" value="4" name="rating">\n              <input type="radio" class="rating__item" value="5" name="rating">\n            </div>\n          </div>\n          <div class="rating__value">${d}</div>\n          <div class="rating__info">${r.length}</div>\n        </div>\n        <div class="product-card__footer">\n          <div class="product-card__price">от ${i} ₽</div>\n          <a href="" class="product-card__compare _icon-compare"></a>\n          <a href="" class="product-card__love _icon-love add-to-favorites"></a>\n        </div>\n        <button type="button" class="product-card__cart button add-to-cart">\n          <span class="_icon-cart">В корзину</span>\n        </button>\n      </div>\n    </article>\n  `}(e):"cart"==t?function({image:t,title:e,price:a,id:n}){return`\n\t\t<li class="cart-header__item"  data-id="${n}">\n\t\t\t<article class="cart-content__product card-product">\n\t\t\t\t<img src="${t}" alt="" class="card-product__item-image-ibg card-product__item-image">\n\t\t\t\t<div class="card-product__text">\n\t\t\t\t\t<h3 class="card-product__title">${e}</h3>\n\t\t\t\t\t<span class="card-product__price">${c=a,String(c).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ₽</span>\n\t\t\t\t</div>\n\t\t\t\t<button class="card-product__delete delete-from-cart" aria-label="Удалить из корзины"></button>\n\t\t\t</article>\n\t\t</li>\n\t`;var c}(e):"favorites"==t?function({image:t,title:e,price:a,id:n,dimensions:c,materials:i,rating:d,feedbacks:r}){return`\n  <article class="product-card" data-id="${n}">\n  <a href="" class="product-card__image">\n    <span class="product-card__item-image-ibg product-card__item-image-ibg_contain">\n      <img src="${t}" alt="Картинка">\n    </span>\n  </a>\n  <div class="product-card__body">\n    <h4 class="product-card__title">\n      <a href="" class="product-card__link-title">${e}</a>\n    </h4>\n    <div class="product-card__info info-product-card">\n      <div class="info-product-card__size">${c.join("х")}</div>\n      <div class="info-product-card__materials">${i.join(", ")}</div>\n    </div>\n    <div class="product-card__rating rating rating_set">\n      <div class="rating__body">\n        <div class="rating__active" style="width: 72%;"></div>\n        <div class="rating__items">\n          <input type="radio" class="rating__item" value="1" name="rating">\n          <input type="radio" class="rating__item" value="2" name="rating">\n          <input type="radio" class="rating__item" value="3" name="rating">\n          <input type="radio" class="rating__item" value="4" name="rating">\n          <input type="radio" class="rating__item" value="5" name="rating">\n        </div>\n      </div>\n      <div class="rating__value">${d}</div>\n      <div class="rating__info">${r.length}</div>\n    </div>\n    <div class="product-card__footer">\n      <div class="product-card__price">от ${a} ₽</div>\n      <a href="" class="product-card__compare _icon-compare"></a>\n      <a href="" class="product-card__love _icon-love add-to-favorites"></a>\n    </div>\n    <button type="button" class="product-card__cart button add-to-cart">\n      <span class="_icon-cart">В корзину</span>\n    </button>\n  </div>\n</article>\n  `}(e):void 0;const n={bubbles:!0,cancelable:!0},c={cart:{add:new Event("cartItemAdded",n),delete:new Event("cartItemRemoved",n)},favorites:{add:new Event("favoritesItemAdded",n),delete:new Event("favoritesItemRemoved",n)},checkout:{add:new Event("checkoutItemAdded",n),delete:new Event("checkoutItemRemoved",n)}};function i(t,e){return a=>{const n=JSON.parse(localStorage.getItem(e))??[],i=a.target.closest("[data-id]"),d=n.findIndex((t=>t.id===i.dataset.id));console.log(d),"add"==t&&-1!==d||("add"==t&&-1===d&&n.push({id:i.dataset.id}),"delete"==t&&n.splice(d,1),localStorage.setItem(e,JSON.stringify(n)),i.dispatchEvent(c[e][t]))}}window.addEventListener("DOMContentLoaded",(t=>{["cart","favorites"].forEach((t=>{localStorage.getItem(t)||localStorage.setItem(t,JSON.stringify([]))}))}));const d=a("cart"),r=i("delete","cart"),o=i("add","cart"),{getBulk:s,getOne:l}=e("cart");window.addEventListener("DOMContentLoaded",(async t=>{g(await s());const e=document.querySelector(".cart-header__basket"),a=document.querySelector(".cart-header__content"),n=a.querySelector(".cart-header__list");e.addEventListener("click",(t=>{n.childElementCount&&(t.stopImmediatePropagation(),a.classList.toggle("active"))}));const i=document.querySelectorAll(".add-to-cart");i.length&&i.forEach((t=>{t.addEventListener("click",o)})),window.addEventListener("storage",(async t=>{if("cart"===t.key){t.stopImmediatePropagation();const e=JSON.parse(t.oldValue),a=JSON.parse(t.newValue);if(a.length===e.length)return;if(console.log("Cart Event: ",t),(a.length>e.length||!e)&&l(a[a.length-1].id).then((t=>{p(t),n.lastElementChild.dispatchEvent(c.checkout.add)})),a.length<e.length){const t=y(e,a);n.querySelectorAll("[data-id]").forEach((e=>{console.log(e),e.dataset.id==t&&e.dispatchEvent(c.cart.delete)}))}m()}})),document.addEventListener("cartItemAdded",f),document.addEventListener("cartItemRemoved",h)}));const u=document.querySelector(".cart-header__quantity"),_=document.querySelector(".cart-header__content"),v=_.querySelector(".cart-header__list");function m(){const t=JSON.parse(localStorage.getItem("cart"));u.textContent=t.length?t.length:0}function g(t){v.innerHTML="",m(),t&&t.forEach(p)}function p(t){const e=d(t);v.insertAdjacentHTML("beforeend",e),v.lastElementChild.querySelector(".card-product__delete").addEventListener("click",r)}function f(t){t.stopImmediatePropagation();const e=t.target.dataset.id;l(e).then(p),m()}function h(t){console.log("item removed"),t.target.closest("[data-id]").remove(),m(),0===v.children.length&&_.classList.remove("active")}function y(t=[],e=[]){const[{id:a}]=t.filter((t=>!e.some((e=>e.id===t.id))));return a}const b=i("add","favorites"),E=i("add","cart"),k=i("delete","favorites"),S=a("favorites"),{getBulk:L,getOne:q}=e("favorites");function $(t){t.addEventListener("click",(t=>{t.preventDefault();const e=JSON.parse(localStorage.getItem("favorites")),a=t.target.closest("[data-id]");if(-1!==e.findIndex((t=>t.id==a.dataset.id)))return k(t);b(t)}))}window.addEventListener("DOMContentLoaded",(t=>{const e=document.querySelectorAll(".add-to-favorites"),a=document.querySelector(".favorites__container");e&&e.forEach($),window.addEventListener("storage",(t=>{if("favorites"===t.key){const e=JSON.parse(t.oldValue),n=JSON.parse(t.newValue);if(console.log(t),n.length===e.length)return;if(t.stopImmediatePropagation(),n.length>e.length&&q(n[n.length-1].id).then((t=>{a&&function(t){return e=>{const a=S(e);t.insertAdjacentHTML("beforeend",a);const n=t.lastElementChild.querySelector(".add-to-favorites"),c=t.lastElementChild.querySelector(".add-to-cart");var i;$(n),(i=n).addEventListener("click",(function(t){t.preventDefault();const e=i.closest(".product-card");e.classList.add("hide"),setTimeout((()=>{e.remove()}),500)})),c.addEventListener("click",E)}}(a)(t)})),n.length<e.length&&a){const t=y(e,n);a.querySelectorAll("[data-id]").forEach((e=>{e.dataset.id==t&&e.dispatchEvent(events.favorites.delete)}))}}}))}));const w=a("checkout"),{getOne:I}=e("cart"),{getBulk:O}=e("cart"),A=document.querySelector("main.page > .checkout > .checkout__container"),C=document.querySelector(".cart-header__list");function j(t){const e=w(t);A.insertAdjacentHTML("beforeend",e);const a=A.lastElementChild,n=C.lastElementChild;a.querySelector(".delete-from-cart").addEventListener("click",(t=>{n.querySelector(".delete-from-cart").click()})),$(a.querySelector(".add-to-favorites"))}window.addEventListener("DOMContentLoaded",(async t=>{A.innerHTML="",O().then((t=>{t&&t.forEach(j)})),document.addEventListener("checkoutItemAdded",(async t=>{console.log("added"),await I(t.target.dataset.id).then(j)})),document.addEventListener("cartItemRemoved",(t=>{A.querySelectorAll("[data-id]").forEach((e=>{e.dataset.id===t.target.dataset.id&&e.remove()}))}))}))})();